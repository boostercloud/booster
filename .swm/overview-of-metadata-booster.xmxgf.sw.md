---
id: xmxgf
name: Overview of metadata-booster
file_version: 1.0.2
app_version: 0.9.1-5
file_blobs:
  packages/framework-integration-tests/tsconfig.json: faa039e08e3ec47adff7179d8e0e3390513cb5ab
  packages/framework-integration-tests/package.json: 16c0cc67061af5e471284228c2d91899f01906ed
  packages/metadata-booster/src/index.ts: a3af5e352db7fffe16f902f0295f2a9fa8d97013
  packages/metadata-booster/package.json: 8825534d1a796cfbdeb9615ba8f91c29e7a21b03
---

The `metadata-booster` package ( `ðŸ“„ packages/metadata-booster` ) is a transformer for the TypeScript compiler.

<br/>

A transformer is something like a plugin that extends the compiler functionality, one can configure it in the `tsconfig.json` file of their project, under the `plugins`[<sup id="Z1AqYAw">â†“</sup>](#f-Z1AqYAw) section:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ packages/framework-integration-tests/tsconfig.json
```json
â¬œ 19           "ES2019",
â¬œ 20           "ES2020"
â¬œ 21         ],
ðŸŸ© 22         "plugins": [
ðŸŸ© 23           { "transform": "metadata-booster" }
ðŸŸ© 24         ]
â¬œ 25       },
â¬œ 26       "include": [
â¬œ 27         "src/**/*"
```

<br/>

To use this, one has to use a patched TypeScript version, because although the official compiler implements the usage of plugins, it doesn't read the configuration from the `tsconfig.json`file.

<br/>

We're currently advising our users to use `ttypescript`[<sup id="Z1hsRjL">â†“</sup>](#f-Z1hsRjL) as their compiler, because it's what we've tested, but it has a limitation, it performs what's called **after-transformations**, which is consuming the user's code as an input, and adding code to the TypeScript output, _after_ it has been compiled. Therefore, the TypeScript type checking cannot be leveraged in this case.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ packages/framework-integration-tests/package.json
```json
â¬œ 48         "serverless": "3.8.0",
â¬œ 49         "serverless-artillery": "0.5.2",
â¬œ 50         "subscriptions-transport-ws": "0.9.18",
ðŸŸ© 51         "ttypescript": "1.5.13",
â¬œ 52         "ws": "7.4.5",
â¬œ 53         "yaml": "1.10.2"
â¬œ 54       },
```

<br/>

After adding `ttypescript`[<sup id="Z1hsRjL">â†“</sup>](#f-Z1hsRjL) as a dev dependency , the user needs to change their compile/build script to use `ttsc`[<sup id="nKde1">â†“</sup>](#f-nKde1) instead of `tsc`:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ packages/framework-integration-tests/package.json
```json
â¬œ 62         "watch:local": "nodemon --watch ../framework-provider-local/dist --watch ../framework-provider-local-infrastructure --watch dist --exec \"../cli/bin/run start -e local\"",
â¬œ 63         "lint:check": "eslint --ext '.js,.ts' **/*.ts",
â¬œ 64         "lint:fix": "eslint --quiet --fix --ext '.js,.ts' **/*.ts",
ðŸŸ© 65         "compile": "ttsc -b tsconfig.json",
â¬œ 66         "clean": "rimraf ./dist tsconfig.tsbuildinfo",
â¬œ 67         "postinstall": "rimraf ../../node_modules/serverless/node_modules/archiver && echo 'Deleted buggy \"archiver\" module from \"serveless\" dependencies to use the newer hoisted one'",
â¬œ 68         "integration": "npm run integration/cli && npm run integration/local && npm run integration/aws && npm run integration/azure",
```

<br/>

There's an alternative tool, called `ts-patch`, which allows **before-transformations**, but it hasn't been tested because we currently don't need that much power, and when we started the project it didn't exist. And although `ttypescript` is not maintained, while `ts-patch` is, the reality is that the former didn't give us any headaches yet.

What `metadata-booster` does is to parse all classes annotated with a decorator, capture the types of the fields, and adds some specific function calls to the generated code that was generated by the TypeScript compiler, so some reflection information that Booster requires is available.

The source code preprocessing and code generation happens in the `transformer`[<sup id="1oLuyB">â†“</sup>](#f-1oLuyB) function. It leverages `ts-morph`[<sup id="1CSMOI">â†“</sup>](#f-1CSMOI) to handle the code parsing into an [AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree).

* * *

Used files:

<br/>



<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ packages/metadata-booster/src/index.ts
<!-- collapsed -->

```typescript
â¬œ 1      import * as ts from 'typescript'
â¬œ 2      import { getClassInfo } from './metadata-extractors'
â¬œ 3      import { createClassMetadataDecorator, createFilterInterfaceFunction } from './statement-creators'
ðŸŸ© 4      
ðŸŸ© 5      const transformer: (program: ts.Program) => ts.TransformerFactory<ts.SourceFile> = (program) => {
ðŸŸ© 6        const checker = program.getTypeChecker()
ðŸŸ© 7        const transformerFactory: ts.TransformerFactory<ts.SourceFile> = (context) => {
ðŸŸ© 8          const f = context.factory
ðŸŸ© 9          const filterInterfaceFunctionName = f.createUniqueName('filterInterface')
ðŸŸ© 10         return (sourceFile) => {
ðŸŸ© 11           const importedTypes: Record<string, string> = {}
ðŸŸ© 12           function visitor(node: ts.Node): ts.VisitResult<ts.Node> {
ðŸŸ© 13             if (ts.isImportDeclaration(node)) {
ðŸŸ© 14               // To ensure we import 'reflect-metadata', delete it from the file in case it is already there.
ðŸŸ© 15               // Later we will add it.
ðŸŸ© 16               const quotedModuleName = node.moduleSpecifier.getText()
ðŸŸ© 17               const moduleName = quotedModuleName.replace(/['']/g, '')
ðŸŸ© 18               if (moduleName == 'reflect-metadata') {
ðŸŸ© 19                 return undefined
ðŸŸ© 20               }
ðŸŸ© 21               const namedBindings = node.importClause?.namedBindings
ðŸŸ© 22               if (namedBindings && 'elements' in namedBindings) {
ðŸŸ© 23                 const setImportedType = (elem: ts.ImportSpecifier): string =>
ðŸŸ© 24                   (importedTypes[elem.name.getText()] = moduleName)
ðŸŸ© 25                 namedBindings.elements.forEach(setImportedType)
ðŸŸ© 26               }
ðŸŸ© 27             }
ðŸŸ© 28     
ðŸŸ© 29             if (ts.isClassDeclaration(node)) {
ðŸŸ© 30               const classInfo = getClassInfo(node, checker)
ðŸŸ© 31               if (classInfo) {
ðŸŸ© 32                 const metadataDecorator = createClassMetadataDecorator(
ðŸŸ© 33                   f,
ðŸŸ© 34                   classInfo,
ðŸŸ© 35                   filterInterfaceFunctionName,
ðŸŸ© 36                   importedTypes
ðŸŸ© 37                 )
ðŸŸ© 38                 const newDecorators = [...(node.decorators ?? []), metadataDecorator]
ðŸŸ© 39                 return f.updateClassDeclaration(
ðŸŸ© 40                   node,
ðŸŸ© 41                   newDecorators,
ðŸŸ© 42                   node.modifiers,
ðŸŸ© 43                   node.name,
ðŸŸ© 44                   node.typeParameters,
ðŸŸ© 45                   node.heritageClauses,
ðŸŸ© 46                   node.members
ðŸŸ© 47                 )
ðŸŸ© 48               }
ðŸŸ© 49             }
ðŸŸ© 50             return ts.visitEachChild(node, visitor, context)
ðŸŸ© 51           }
ðŸŸ© 52           const modifiedSourceFile = ts.visitNode(sourceFile, visitor)
ðŸŸ© 53           return f.updateSourceFile(modifiedSourceFile, [
ðŸŸ© 54             f.createImportDeclaration(undefined, undefined, undefined, f.createStringLiteral('reflect-metadata')),
ðŸŸ© 55             ...modifiedSourceFile.statements,
ðŸŸ© 56             createFilterInterfaceFunction(f, filterInterfaceFunctionName),
ðŸŸ© 57           ])
ðŸŸ© 58         }
ðŸŸ© 59       }
ðŸŸ© 60     
ðŸŸ© 61       return transformerFactory
ðŸŸ© 62     }
ðŸŸ© 63     
â¬œ 64     export default transformer
â¬œ 65     export * from './metadata-types'
â¬œ 66     
```

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ packages/metadata-booster/package.json
<!-- collapsed -->

```json
ðŸŸ© 1      {
ðŸŸ© 2        "name": "@boostercloud/metadata-booster",
ðŸŸ© 3        "version": "0.29.6",
ðŸŸ© 4        "description": "Emits detailed metadata of your types. You can then get it in runtime to deal with schema-aware operation, like defining GraphQL schemas, ORM operations, etc.",
ðŸŸ© 5        "repository": "https://github.com/boostercloud/booster.git",
ðŸŸ© 6        "keywords": [
ðŸŸ© 7          "metadata",
ðŸŸ© 8          "transformer",
ðŸŸ© 9          "booster",
ðŸŸ© 10         "reflect"
ðŸŸ© 11       ],
ðŸŸ© 12       "author": "Booster Cloud",
ðŸŸ© 13       "license": "Apache-2.0",
ðŸŸ© 14       "bugs": {
ðŸŸ© 15         "url": "https://github.com/boostercloud/booster/issues"
ðŸŸ© 16       },
ðŸŸ© 17       "homepage": "https://github.com/boostercloud/booster#readme",
ðŸŸ© 18       "main": "dist/index.js",
ðŸŸ© 19       "files": [
ðŸŸ© 20         "dist"
ðŸŸ© 21       ],
ðŸŸ© 22       "dependencies": {
ðŸŸ© 23         "tslib": "2.3.1",
ðŸŸ© 24         "ts-morph": "13.0.2",
ðŸŸ© 25         "reflect-metadata": "0.1.13"
ðŸŸ© 26       },
ðŸŸ© 27       "devDependencies": {
ðŸŸ© 28         "@types/node": "16.11.7",
ðŸŸ© 29         "ttypescript": "1.5.13",
ðŸŸ© 30         "typescript": "4.5.4"
ðŸŸ© 31       },
ðŸŸ© 32       "scripts": {
ðŸŸ© 33         "lint:check": "eslint --ext '.js,.ts' **/*.ts",
ðŸŸ© 34         "lint:fix": "eslint --quiet --fix --ext '.js,.ts' **/*.ts",
ðŸŸ© 35         "compile": "tsc -b tsconfig.json",
ðŸŸ© 36         "prepack": "tsc -b tsconfig.json",
ðŸŸ© 37         "test": "ttsc -p tsconfig.test.json"
ðŸŸ© 38       }
ðŸŸ© 39     }
ðŸŸ© 40     
```

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-Z1AqYAw">plugins</span>[^](#Z1AqYAw) - "packages/framework-integration-tests/tsconfig.json" L22
```json
    "plugins": [
```

<span id="f-1oLuyB">transformer</span>[^](#1oLuyB) - "packages/metadata-booster/src/index.ts" L5
```typescript
const transformer: (program: ts.Program) => ts.TransformerFactory<ts.SourceFile> = (program) => {
```

<span id="f-1CSMOI">ts-morph</span>[^](#1CSMOI) - "packages/metadata-booster/package.json" L24
```json
    "ts-morph": "13.0.2",
```

<span id="f-nKde1">ttsc</span>[^](#nKde1) - "packages/framework-integration-tests/package.json" L65
```json
    "compile": "ttsc -b tsconfig.json",
```

<span id="f-Z1hsRjL">ttypescript</span>[^](#Z1hsRjL) - "packages/framework-integration-tests/package.json" L51
```json
    "ttypescript": "1.5.13",
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBYm9vc3RlciUzQSUzQWJvb3N0ZXJjbG91ZA==/docs/xmxgf).