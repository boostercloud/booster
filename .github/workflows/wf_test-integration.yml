name: Integration
on:
  pull_request:
    types: [unlocked] # All integration tests are run every time the PR conversation is unlocked

  workflow_call:
    # TODO: These inputs are not being used for now, we will change this when
    # we start reacting to comments in the PR
    inputs:
      aws-region:
        default: 'us-east-1'
        required: false
        type: string
      azure-region:
        default: 'Central US'
        required: false
        type: string
      azure-publisher-email:
        default: noreply@booster.cloud
        required: false
        type: string
      azure-publisher-name:
        default: Booster App
        required: false
        type: string

    secrets:
      BOT_AWS_ACCESS_KEY_ID:
        required: true
        type: string
      BOT_AWS_SECRET_ACCESS_KEY:
        required: true
        type: string
      AZURE_CLIENTID:
        required: true
        type: string
      AZURE_SECRET:
        required: true
        type: string
      AZURE_TENANTID:
        required: true
        type: string
      AZURE_SUBSCRIPTIONID:
        required: true
        type: string
      AZURE_CREDENTIALS:
        required: true
        type: string

permissions:
  id-token: write

jobs:
  prepare-integration-tests:
    uses: ./.github/workflows/re_test-integration-prepare.yml

  aws-integration-tests:
    name: AWS Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-aws.yml
    secrets: inherit

  cli-integration-tests:
    name: CLI Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-cli.yml
    secrets: inherit

  local-integration-tests:
    name: Local Provider Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-local.yml
    secrets: inherit

  azure-integration-tests:
    name: Azure Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-azure.yml
    secrets: inherit
