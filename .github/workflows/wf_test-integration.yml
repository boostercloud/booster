name: Integration
on:
  pull_request:
    types: [locked] # All integration tests are run every time the PR is locked

permissions:
  id-token: write

jobs:
  prepare-integration-tests:
    uses: ./.github/workflows/re_test-integration-prepare

  aws-integration-tests:
    name: AWS Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-aws
    secrets: inherit

  cli-integration-tests:
    name: CLI Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-cli
    secrets: inherit

  local-integration-tests:
    name: Local Provider Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-local
    secrets: inherit

  azure-integration-tests:
    name: Azure Integration Tests
    needs: prepare-integration-tests
    runs-on: ubuntu-latest
    uses: ./.github/workflows/re_test-integration-azure
    secrets: inherit
