import { StockMoved } from '../events/StockMoved'
import { Register } from '@boostercloud/framework-types'
import { ProductAvailabilityChanged } from '../events/ProductAvailabilityChanged'
import { EventHandler } from '@boostercloud/framework-core'

@EventHandler(StockMoved)
export class HandleAvailability {
  public static async handle(event: StockMoved, register: Register): Promise<void> {
    if (event.origin == 'provider') {
      // New stock enters the system
      register.events(new ProductAvailabilityChanged(event.productID, event.quantity))
    } else if (event.destination == 'customer') {
      // Stock goes to the customer
      register.events(new ProductAvailabilityChanged(event.productID, -event.quantity))
    }
    // In terms of availability, it doesn't matter in which warehouse the stock is as soon as there's stock
  }
}
