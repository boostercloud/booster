"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1543],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=a,f=m["".concat(l,".").concat(d)]||m[d]||p[d]||o;return n?r.createElement(f,i(i({ref:t},u),{},{components:n})):r.createElement(f,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2991:(e,t,n)=>{n.d(t,{Z:()=>b});var r=n(7294),a=n(6010),o=n(3438),i=n(9960),s=n(3919),l=n(5999);const c="cardContainer_fWXF",u="cardTitle_rnsV",p="cardDescription_PWke";function m(e){let{href:t,children:n}=e;return r.createElement(i.Z,{href:t,className:(0,a.Z)("card padding--lg",c)},n)}function d(e){let{href:t,icon:n,title:o,description:i}=e;return r.createElement(m,{href:t},r.createElement("h2",{className:(0,a.Z)("text--truncate",u),title:o},n," ",o),i&&r.createElement("p",{className:(0,a.Z)("text--truncate",p),title:i},i))}function f(e){let{item:t}=e;const n=(0,o.Wl)(t);return n?r.createElement(d,{href:n,icon:"\ud83d\uddc3\ufe0f",title:t.label,description:t.description??(0,l.I)({message:"{count} items",id:"theme.docs.DocCard.categoryDescription",description:"The default description for a category card in the generated index about how many items this category includes"},{count:t.items.length})}):null}function h(e){let{item:t}=e;const n=(0,s.Z)(t.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",a=(0,o.xz)(t.docId??void 0);return r.createElement(d,{href:t.href,icon:n,title:t.label,description:t.description??(null==a?void 0:a.description)})}function g(e){let{item:t}=e;switch(t.type){case"link":return r.createElement(h,{item:t});case"category":return r.createElement(f,{item:t});default:throw new Error(`unknown item type ${JSON.stringify(t)}`)}}function y(e){let{className:t}=e;const n=(0,o.jA)();return r.createElement(b,{items:n.items,className:t})}function b(e){const{items:t,className:n}=e;if(!t)return r.createElement(y,e);const i=(0,o.MN)(t);return r.createElement("section",{className:(0,a.Z)("row",n)},i.map(((e,t)=>r.createElement("article",{key:t,className:"col col--6 margin-bottom--lg"},r.createElement(g,{item:e})))))}},2698:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var r=n(7462),a=(n(7294),n(3905)),o=n(2991);const i={},s="Scaling Booster Azure Functions",l={unversionedId:"going-deeper/azure-scale",id:"going-deeper/azure-scale",title:"Scaling Booster Azure Functions",description:"Booster Azure Provider relies on CosmosDB change feed processor to consume new events.",source:"@site/docs/10_going-deeper/azure-scale.mdx",sourceDirName:"10_going-deeper",slug:"/going-deeper/azure-scale",permalink:"/going-deeper/azure-scale",draft:!1,editUrl:"https://github.com/boostercloud/booster/tree/main/website/docs/10_going-deeper/azure-scale.mdx",tags:[],version:"current",lastUpdatedBy:"gonzalojaubert",lastUpdatedAt:1700228463,formattedLastUpdatedAt:"Nov 17, 2023",frontMatter:{},sidebar:"docs",previous:{title:"Booster instrumentation",permalink:"/going-deeper/instrumentation"},next:{title:"Frequently Asked Questions",permalink:"/frequently-asked-questions"}},c={},u=[{value:"Parameters",id:"parameters",level:2},{value:"Infrastructure",id:"infrastructure",level:2},{value:"Recommendations",id:"recommendations",level:2}],p={toc:u};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"scaling-booster-azure-functions"},"Scaling Booster Azure Functions"),(0,a.kt)("p",null,"Booster Azure Provider relies on CosmosDB ",(0,a.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/change-feed-processor"},"change feed processor")," to consume new events.\nIn CosmosDB, the partition keys are distributed in ranges, where each range represents a physical partition. ",(0,a.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/cosmos-db/partitioning-overview#physical-partitions"},"Unlike logical partitions,\nphysical partitions are an internal implementation of the system and Azure Cosmos DB entirely manages physical partitions")),(0,a.kt)("p",null,"With Booster EventStream functionality, we could define the number of physical partitions our events are split and create instances for each partition."),(0,a.kt)("p",null,"To enable EventStream, set the ",(0,a.kt)("inlineCode",{parentName:"p"},"EventStreamConfiguration")," in the configuration object:"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Warning"),": Currently, only available for Azure provider.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"  config.eventStreamConfiguration = {\n    enabled: true,\n    parameters: {\n      streamTopic: 'test',\n      partitionCount: 3,\n      messageRetention: 1,\n      maxRetries: 5,\n      mode: 'exponential'\n    },\n  }\n")),(0,a.kt)("h2",{id:"parameters"},"Parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"StreamTopic: Define the internal topic name Booster will use."),(0,a.kt)("li",{parentName:"ul"},"PartitionCount: Number of Event Hub partitions. The number of functions app consumer instances will match the partition count"),(0,a.kt)("li",{parentName:"ul"},"MessageRetention: Specifies the number of days to retain the events for this Event Hub"),(0,a.kt)("li",{parentName:"ul"},"MaxRetries: Number of retries to consume an event"),(0,a.kt)("li",{parentName:"ul"},"Mode: Retry mode. It could be ",(0,a.kt)("inlineCode",{parentName:"li"},"fixed")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"exponential"))),(0,a.kt)("p",null,"Note: ",(0,a.kt)("inlineCode",{parentName:"p"},"maxRetries")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"mode")," are configured at Function level"),(0,a.kt)("h2",{id:"infrastructure"},"Infrastructure"),(0,a.kt)("p",null,"Enabling ",(0,a.kt)("inlineCode",{parentName:"p"},"EventStreamConfiguration")," will apply some changes to the infrastructure:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Two functions will be created",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"One function with a CosmosDB consumer that will produce Event Hubs events. Also, it will include the readModels functions, schedule functions app, etc..."),(0,a.kt)("li",{parentName:"ul"},"One function with an Event Hub consumer function app. This function will allow you to define the number of instances to be created"))),(0,a.kt)("li",{parentName:"ul"},"A new container to handle duplicated consumed events"),(0,a.kt)("li",{parentName:"ul"},"A new Event Hub will be added for event handling.")),(0,a.kt)("h2",{id:"recommendations"},"Recommendations"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/event-hubs/dynamically-add-partitions#recommendations"},"From the Azure documentation"),":"),(0,a.kt)("p",null,"Dynamically adding partitions isn't recommended. While the existing data preserves ordering, partition hashing will be broken for messages hashed after the\npartition count changes due to addition of partitions."),(0,a.kt)(o.Z,{mdxType:"DocCardList"}))}m.isMDXComponent=!0}}]);